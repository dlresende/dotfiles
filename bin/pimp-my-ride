#!/usr/bin/env bash

main() {
  install_homebrew
  install_stuff
  configure_homebrew_to_work_with_multiple_accounts
  configure_vim
  configure_tmux
  install_oh_my_zsh
}

install_homebrew() {
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
}

install_stuff() {
  brew bundle
}

configure_vim() {
  if [[ ! -d "${HOME}/.vim" ]] ; then
    git clone https://github.com/luan/vimfiles.git ~/.vim
  fi
  (
  cd "${HOME}/.vim" || exit 1
  git checkout master
  git pull -r
  ./update
  )
}

configure_tmux() {
  TMUX_PLUGIN_MANAGER_PATH="$HOME/.tmux/plugins"

  echo "Updating tmux plugins..."
  if [[ ! -d "$TMUX_PLUGIN_MANAGER_PATH/tpm" ]] ; then
    mkdir -p "$TMUX_PLUGIN_MANAGER_PATH"
    git clone https://github.com/tmux-plugins/tpm "$TMUX_PLUGIN_MANAGER_PATH/tpm"
    ./"$TMUX_PLUGIN_MANAGER_PATH"/tpm/bin/install_plugins
  else
    (cd "$TMUX_PLUGIN_MANAGER_PATH/tpm" && git pull )
    ./"$TMUX_PLUGIN_MANAGER_PATH"/tpm/bin/update_plugins all
  fi
}

configure_homebrew_to_work_with_multiple_accounts() {
  sudo chgrp -R admin /usr/local/Homebrew
  sudo chmod -R g+w /usr/local/Homebrew
}

install_oh_my_zsh() {
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
}

main
